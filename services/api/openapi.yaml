openapi: 3.0.3
info:
  title: NeuroNews Services API
  description: REST API for NeuroNews question answering with citations
  version: 1.0.0
  contact:
    name: NeuroNews Platform Team
    email: platform@neuronews.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://api.neuronews.com/api
    description: Production server
  - url: https://staging-api.neuronews.com/api
    description: Staging server
  - url: http://localhost:8000/api
    description: Development server

paths:
  /ask:
    post:
      summary: Ask a question
      description: Submit a question to get an AI-generated answer with citations from news articles
      operationId: askQuestion
      tags:
        - Question Answering
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AskRequest'
            examples:
              simple_question:
                summary: Simple question
                value:
                  question: "What happened in the stock market today?"
              filtered_question:
                summary: Question with filters
                value:
                  question: "What are the latest developments in AI technology?"
                  k: 10
                  filters:
                    category: "technology"
                    date_from: "2025-08-01"
                  rerank_on: true
                  fusion: true
                  provider: "openai"
              economic_question:
                summary: Economic analysis question
                value:
                  question: "How does renewable energy impact the economy?"
                  k: 5
                  filters:
                    source: "reuters"
                    language: "en"
                  provider: "anthropic"
      responses:
        '200':
          description: Successful response with answer and citations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AskResponse'
              examples:
                ai_technology_response:
                  summary: AI technology answer
                  value:
                    question: "What are the latest developments in AI technology?"
                    answer: "Recent developments in AI technology include breakthroughs in large language models, improved computer vision capabilities, and advances in autonomous systems. Major tech companies have announced new AI chips designed for better performance and energy efficiency."
                    citations:
                      - citation_id: 1
                        title: "AI Chip Breakthrough Announced by Tech Giants"
                        source: "TechNews"
                        url: "https://technews.com/ai-chip-breakthrough-2025"
                        relevance_score: 0.95
                        published_date: "2025-08-28T10:30:00Z"
                        excerpt: "Major technology companies unveiled new AI processing chips that promise 50% better performance..."
                        citation_strength: 0.9
                    metadata:
                      total_time_ms: 1250.5
                      retrieval_time_ms: 400.2
                      generation_time_ms: 750.8
                      documents_found: 15
                      documents_used: 5
                      reranked: true
                      query_fusion_used: true
                      provider_used: "openai"
                    request_id: "550e8400-e29b-41d4-a716-446655440000"
                    tracked_in_mlflow: true
        '422':
          description: Validation error - invalid request format or parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                missing_question:
                  summary: Missing required question field
                  value:
                    detail:
                      - loc: ["body", "question"]
                        msg: "field required"
                        type: "value_error.missing"
                invalid_k_value:
                  summary: Invalid k parameter
                  value:
                    detail:
                      - loc: ["body", "k"]
                        msg: "ensure this value is less than or equal to 20"
                        type: "value_error.number.not_le"
                        ctx: {"limit_value": 20}
                invalid_provider:
                  summary: Invalid provider value
                  value:
                    detail:
                      - loc: ["body", "provider"]
                        msg: "value is not a valid enumeration member; permitted: 'openai', 'anthropic', 'cohere', 'huggingface'"
                        type: "value_error.enum"
                        ctx: {"enum_values": ["openai", "anthropic", "cohere", "huggingface"]}
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RateLimitError'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalError'

  /ask/batch:
    post:
      summary: Ask multiple questions
      description: Submit multiple questions in a single batch request
      operationId: askQuestionsBatch
      tags:
        - Question Answering
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatchAskRequest'
      responses:
        '200':
          description: Successful batch response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchAskResponse'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RateLimitError'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalError'

components:
  schemas:
    AskRequest:
      type: object
      required:
        - question
      properties:
        question:
          type: string
          minLength: 3
          maxLength: 500
          description: The question to answer
          example: "What are the latest developments in AI technology?"
        k:
          type: integer
          minimum: 1
          maximum: 20
          default: 5
          description: Number of documents to retrieve for context
        filters:
          type: object
          description: Filters to apply during document retrieval
          properties:
            source:
              type: string
              description: Filter by news source
              example: "bbc"
            date_from:
              type: string
              format: date
              description: Filter articles from this date (YYYY-MM-DD)
              example: "2025-08-01"
            date_to:
              type: string
              format: date
              description: Filter articles until this date (YYYY-MM-DD)
              example: "2025-08-28"
            language:
              type: string
              enum: [en, es, fr, de, it]
              description: Filter by article language
            category:
              type: string
              enum: [politics, business, technology, sports, entertainment, health, science]
              description: Filter by article category
          additionalProperties: false
        rerank_on:
          type: boolean
          default: true
          description: Whether to enable reranking of retrieved documents
        fusion:
          type: boolean
          default: true
          description: Whether to enable query fusion for better retrieval
        provider:
          type: string
          enum: [openai, anthropic, cohere, huggingface]
          default: openai
          description: Answer generation provider to use
      additionalProperties: false

    AskResponse:
      type: object
      required:
        - question
        - answer
        - citations
        - metadata
        - request_id
        - tracked_in_mlflow
      properties:
        question:
          type: string
          description: The original question that was asked
        answer:
          type: string
          description: The generated answer to the question
        citations:
          type: array
          description: List of citations with sources used to generate the answer
          items:
            $ref: '#/components/schemas/Citation'
        metadata:
          $ref: '#/components/schemas/ResponseMetadata'
        request_id:
          type: string
          pattern: '^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$'
          description: Unique request identifier (UUID format)
        tracked_in_mlflow:
          type: boolean
          description: Whether this request was logged to MLflow for tracking
      additionalProperties: false

    Citation:
      type: object
      required:
        - citation_id
        - title
        - source
        - url
        - relevance_score
        - published_date
        - excerpt
        - citation_strength
      properties:
        citation_id:
          type: integer
          minimum: 1
          description: Unique citation identifier within the response
        title:
          type: string
          description: Title of the source article
        source:
          type: string
          description: News source or publisher name
        url:
          type: string
          format: uri
          description: URL of the source article
        relevance_score:
          type: number
          minimum: 0
          maximum: 1
          description: Relevance score of the document to the query (0-1)
        published_date:
          type: string
          format: date-time
          description: Publication date of the article (ISO 8601 format)
        excerpt:
          type: string
          description: Relevant excerpt from the article
        citation_strength:
          type: number
          minimum: 0
          maximum: 1
          description: Strength of the citation in supporting the answer (0-1)
      additionalProperties: false

    ResponseMetadata:
      type: object
      required:
        - total_time_ms
        - documents_found
        - provider_used
      properties:
        total_time_ms:
          type: number
          minimum: 0
          description: Total response time in milliseconds
        retrieval_time_ms:
          type: number
          minimum: 0
          description: Document retrieval time in milliseconds
        generation_time_ms:
          type: number
          minimum: 0
          description: Answer generation time in milliseconds
        documents_found:
          type: integer
          minimum: 0
          description: Number of documents found for the query
        documents_used:
          type: integer
          minimum: 0
          description: Number of documents actually used for answer generation
        reranked:
          type: boolean
          description: Whether documents were reranked
        query_fusion_used:
          type: boolean
          description: Whether query fusion was applied
        provider_used:
          type: string
          description: The answer generation provider that was used
      additionalProperties: true

    BatchAskRequest:
      type: object
      required:
        - questions
      properties:
        questions:
          type: array
          minItems: 1
          maxItems: 10
          items:
            $ref: '#/components/schemas/AskRequest'
          description: List of questions to process in batch
        parallel:
          type: boolean
          default: true
          description: Whether to process questions in parallel
      additionalProperties: false

    BatchAskResponse:
      type: object
      required:
        - responses
        - batch_metadata
      properties:
        responses:
          type: array
          items:
            $ref: '#/components/schemas/AskResponse'
          description: List of individual question responses
        batch_metadata:
          type: object
          properties:
            total_questions:
              type: integer
              minimum: 1
            successful_responses:
              type: integer
              minimum: 0
            failed_responses:
              type: integer
              minimum: 0
            total_batch_time_ms:
              type: number
              minimum: 0
          required:
            - total_questions
            - successful_responses
            - failed_responses
            - total_batch_time_ms
      additionalProperties: false

    ValidationError:
      type: object
      required:
        - detail
      properties:
        detail:
          type: array
          items:
            type: object
            properties:
              loc:
                type: array
                items:
                  anyOf:
                    - type: string
                    - type: integer
                description: Location of the error in the request
              msg:
                type: string
                description: Human-readable error message
              type:
                type: string
                description: Error type identifier
              ctx:
                type: object
                description: Additional context for the error
            required:
              - loc
              - msg
              - type

    RateLimitError:
      type: object
      required:
        - detail
        - retry_after
      properties:
        detail:
          type: string
          description: Human-readable error message
          example: "Rate limit exceeded. Please wait before making another request."
        retry_after:
          type: integer
          description: Number of seconds to wait before retrying
          example: 60

    InternalError:
      type: object
      required:
        - detail
        - error_id
      properties:
        detail:
          type: string
          description: Human-readable error message
          example: "An internal server error occurred. Please try again later."
        error_id:
          type: string
          description: Unique error identifier for tracking
          example: "err_550e8400-e29b-41d4-a716-446655440000"

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication

security:
  - ApiKeyAuth: []

tags:
  - name: Question Answering
    description: AI-powered question answering with citations
