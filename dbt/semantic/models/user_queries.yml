# User Interaction Semantic Model
# Defines the semantic layer for user queries and system interactions

semantic_models:
  - name: user_queries
    description: "Semantic model for user question-answering interactions with the NeuroNews system"
    model: ref('user_queries')  # References the user_queries model in dbt
    
    # Primary entity
    entities:
      - name: query_id
        type: primary
        expr: query_id
        
      - name: user_id
        type: foreign
        expr: user_id

    # Dimensions
    dimensions:
      - name: query_date
        type: time
        type_params:
          time_granularity: day
        expr: created_at
        
      - name: query_text
        type: categorical
        expr: question
        
      - name: provider
        type: categorical
        expr: provider
        
      - name: response_time_ms
        type: numerical
        expr: response_time_ms
        
      - name: num_citations
        type: numerical
        expr: num_citations
        
      - name: rerank_enabled
        type: categorical
        expr: rerank_enabled
        
      - name: fusion_enabled
        type: categorical
        expr: fusion_enabled

    # Measures
    measures:
      - name: total_queries
        description: "Total number of user queries"
        agg: count
        expr: query_id
        
      - name: avg_response_time
        description: "Average response time in milliseconds"
        agg: average
        expr: response_time_ms
        
      - name: max_response_time
        description: "Maximum response time in milliseconds"
        agg: max
        expr: response_time_ms
        
      - name: avg_citations_per_query
        description: "Average number of citations per query"
        agg: average
        expr: num_citations
        
      - name: unique_users
        description: "Count of unique users"
        agg: count_distinct
        expr: user_id
