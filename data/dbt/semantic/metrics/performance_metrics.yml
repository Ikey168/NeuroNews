# Performance Metrics
# System performance and operational metrics for monitoring

metrics:
  - name: total_queries
    description: "Total number of user queries processed"
    type: simple
    type_params:
      measure: total_queries
    model: ref('user_queries')
    
  - name: avg_response_time
    description: "Average response time for user queries"
    type: simple
    type_params:
      measure: avg_response_time
    model: ref('user_queries')
    
  - name: max_response_time
    description: "Maximum response time for user queries"
    type: simple
    type_params:
      measure: max_response_time
    model: ref('user_queries')
    
  - name: avg_citations_per_query
    description: "Average number of citations returned per query"
    type: simple
    type_params:
      measure: avg_citations_per_query
    model: ref('user_queries')
    
  - name: unique_active_users
    description: "Number of unique active users"
    type: simple
    type_params:
      measure: unique_users
    model: ref('user_queries')
    
  # Performance threshold metrics
  - name: fast_queries_count
    description: "Number of queries with response time under 2 seconds"
    type: simple
    type_params:
      measure: total_queries
    filter: |
      {{ Dimension('user_queries__response_time_ms') }} < 2000
    model: ref('user_queries')
    
  - name: slow_queries_count
    description: "Number of queries with response time over 5 seconds"
    type: simple
    type_params:
      measure: total_queries
    filter: |
      {{ Dimension('user_queries__response_time_ms') }} > 5000
    model: ref('user_queries')
    
  # Ratio metrics
  - name: fast_query_percentage
    description: "Percentage of queries with fast response times (< 2s)"
    type: ratio
    type_params:
      numerator: fast_queries_count
      denominator: total_queries
    
  - name: slow_query_percentage
    description: "Percentage of queries with slow response times (> 5s)"
    type: ratio
    type_params:
      numerator: slow_queries_count
      denominator: total_queries
